import{i as de,f as X,I as $e,L as be}from"./fetch.UBuoTI4j.js";import{w as y}from"./index.BLWFmFSp.js";import{s as he,L as x,O as ee,k as G,P as J,n as te,x as we,e as U,a as S,c as V,g as q,b as Y,f as w,m as E,i as R,h as B,Q as ve,t as T,d as j,j as ke,o as ie,R as se,H as De}from"./scheduler.CjD0NZ8o.js";import{S as Fe,i as Oe,f as ne,c as v,a as k,m as D,t as g,b as d,d as F,g as Ie,e as Re}from"./index.or77jMZA.js";import{g as me,a as ce}from"./spread.CgU5AtxT.js";import{B as Ce}from"./index.Cy1MAQMk.js";import{z as K,R as Se,s as qe,a as Le,d as Pe,b as Be,D as Ee,c as Te,F as fe,e as je,C as _e,f as pe,g as ge,h as ze}from"./zod.Dn88xz39.js";import{L as Ue}from"./label.BOUvaJbB.js";import{B as Ve}from"./date.DCN9688O.js";import"./entry.B9pAj-Df.js";const le=K.object({name:K.string().min(1).max(20),color:K.string().regex(new RegExp("^#[0-9a-f]{6}$"))});function Ne(a){let t=a[7]?"新建":"编辑",n,e;return{c(){n=T(t),e=T("标签")},l(o){n=j(o,t),e=j(o,"标签")},m(o,r){R(o,n,r),R(o,e,r)},p:te,d(o){o&&(w(n),w(e))}}}function Ae(a){let t,n;return t=new je({props:{$$slots:{default:[Ne]},$$scope:{ctx:a}}}),{c(){v(t.$$.fragment)},l(e){k(t.$$.fragment,e)},m(e,o){D(t,e,o),n=!0},p(e,o){const r={};o&65536&&(r.$$scope={dirty:o,ctx:e}),t.$set(r)},i(e){n||(g(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){F(t,e)}}}function He(a){let t;return{c(){t=T("标签名")},l(n){t=j(n,"标签名")},m(n,e){R(n,t,e)},d(n){n&&w(t)}}}function Me(a){let t,n,e,o,r;t=new ge({props:{$$slots:{default:[He]},$$scope:{ctx:a}}});const s=[a[15],{autocomplete:"off"}];function $(f){a[9](f)}let p={};for(let f=0;f<s.length;f+=1)p=ie(p,s[f]);return a[1].name!==void 0&&(p.value=a[1].name),e=new $e({props:p}),x.push(()=>ne(e,"value",$)),{c(){v(t.$$.fragment),n=S(),v(e.$$.fragment)},l(f){k(t.$$.fragment,f),n=q(f),k(e.$$.fragment,f)},m(f,_){D(t,f,_),R(f,n,_),D(e,f,_),r=!0},p(f,_){const O={};_&65536&&(O.$$scope={dirty:_,ctx:f}),t.$set(O);const b=_&32768?me(s,[ce(f[15]),s[1]]):{};!o&&_&2&&(o=!0,b.value=f[1].name,ee(()=>o=!1)),e.$set(b)},i(f){r||(g(t.$$.fragment,f),g(e.$$.fragment,f),r=!0)},o(f){d(t.$$.fragment,f),d(e.$$.fragment,f),r=!1},d(f){f&&w(n),F(t,f),F(e,f)}}}function Qe(a){let t,n,e,o;return t=new _e({props:{$$slots:{default:[Me,({attrs:r})=>({15:r}),({attrs:r})=>r?32768:0]},$$scope:{ctx:a}}}),e=new pe({}),{c(){v(t.$$.fragment),n=S(),v(e.$$.fragment)},l(r){k(t.$$.fragment,r),n=q(r),k(e.$$.fragment,r)},m(r,s){D(t,r,s),R(r,n,s),D(e,r,s),o=!0},p(r,s){const $={};s&98306&&($.$$scope={dirty:s,ctx:r}),t.$set($)},i(r){o||(g(t.$$.fragment,r),g(e.$$.fragment,r),o=!0)},o(r){d(t.$$.fragment,r),d(e.$$.fragment,r),o=!1},d(r){r&&w(n),F(t,r),F(e,r)}}}function Ge(a){let t;return{c(){t=T("颜色")},l(n){t=j(n,"颜色")},m(n,e){R(n,t,e)},d(n){n&&w(t)}}}function Je(a){let t,n,e,o,r,s,$,p,f,_;t=new ge({props:{$$slots:{default:[Ge]},$$scope:{ctx:a}}});const O=[a[15],{autocomplete:"off"}];function b(u){a[10](u)}let h={};for(let u=0;u<O.length;u+=1)h=ie(h,O[u]);return a[1].color!==void 0&&(h.value=a[1].color),o=new $e({props:h}),x.push(()=>ne(o,"value",b)),{c(){v(t.$$.fragment),n=S(),e=U("div"),v(o.$$.fragment),s=S(),$=U("input"),this.h()},l(u){k(t.$$.fragment,u),n=q(u),e=V(u,"DIV",{class:!0});var i=Y(e);k(o.$$.fragment,i),s=q(i),$=V(i,"INPUT",{type:!0,class:!0}),i.forEach(w),this.h()},h(){E($,"type","color"),E($,"class","border-0"),E(e,"class","flex items-center space-x-2")},m(u,i){D(t,u,i),R(u,n,i),R(u,e,i),D(o,e,null),B(e,s),B(e,$),se($,a[1].color),p=!0,f||(_=De($,"input",a[11]),f=!0)},p(u,i){const I={};i&65536&&(I.$$scope={dirty:i,ctx:u}),t.$set(I);const L=i&32768?me(O,[ce(u[15]),O[1]]):{};!r&&i&2&&(r=!0,L.value=u[1].color,ee(()=>r=!1)),o.$set(L),i&2&&se($,u[1].color)},i(u){p||(g(t.$$.fragment,u),g(o.$$.fragment,u),p=!0)},o(u){d(t.$$.fragment,u),d(o.$$.fragment,u),p=!1},d(u){u&&(w(n),w(e)),F(t,u),F(o),f=!1,_()}}}function Ke(a){let t,n,e,o;return t=new _e({props:{$$slots:{default:[Je,({attrs:r})=>({15:r}),({attrs:r})=>r?32768:0]},$$scope:{ctx:a}}}),e=new pe({}),{c(){v(t.$$.fragment),n=S(),v(e.$$.fragment)},l(r){k(t.$$.fragment,r),n=q(r),k(e.$$.fragment,r)},m(r,s){D(t,r,s),R(r,n,s),D(e,r,s),o=!0},p(r,s){const $={};s&98306&&($.$$scope={dirty:s,ctx:r}),t.$set($)},i(r){o||(g(t.$$.fragment,r),g(e.$$.fragment,r),o=!0)},o(r){d(t.$$.fragment,r),d(e.$$.fragment,r),o=!1},d(r){r&&w(n),F(t,r),F(e,r)}}}function We(a){let t;return{c(){t=T("预览：")},l(n){t=j(n,"预览：")},m(n,e){R(n,t,e)},d(n){n&&w(t)}}}function Xe(a){let t=a[1].name+"",n;return{c(){n=T(t)},l(e){n=j(e,t)},m(e,o){R(e,n,o)},p(e,o){o&2&&t!==(t=e[1].name+"")&&ke(n,t)},d(e){e&&w(n)}}}function Ye(a){let t,n;return t=new ze({props:{class:"w-full",$$slots:{default:[ye]},$$scope:{ctx:a}}}),{c(){v(t.$$.fragment)},l(e){k(t.$$.fragment,e)},m(e,o){D(t,e,o),n=!0},i(e){n||(g(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){F(t,e)}}}function Ze(a){let t,n;return t=new Ce({props:{class:"w-full",$$slots:{default:[xe]},$$scope:{ctx:a}}}),{c(){v(t.$$.fragment)},l(e){k(t.$$.fragment,e)},m(e,o){D(t,e,o),n=!0},i(e){n||(g(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){F(t,e)}}}function ye(a){let t;return{c(){t=T("保存")},l(n){t=j(n,"保存")},m(n,e){R(n,t,e)},d(n){n&&w(t)}}}function xe(a){let t,n;return t=new be({props:{class:"mr-2 h-4 w-4 animate-spin"}}),{c(){v(t.$$.fragment)},l(e){k(t.$$.fragment,e)},m(e,o){D(t,e,o),n=!0},p:te,i(e){n||(g(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){F(t,e)}}}function et(a){let t,n,e,o,r,s,$,p,f,_,O,b,h,u,i,I,L,z,N;e=new Te({props:{$$slots:{default:[Ae]},$$scope:{ctx:a}}}),s=new fe({props:{form:a[4],name:"name",$$slots:{default:[Qe]},$$scope:{ctx:a}}}),p=new fe({props:{form:a[4],name:"color",$$slots:{default:[Ke]},$$scope:{ctx:a}}}),O=new Ue({props:{$$slots:{default:[We]},$$scope:{ctx:a}}}),h=new Ve({props:{class:"mb-1 text-white",style:"background-color:"+a[1].color,$$slots:{default:[Xe]},$$scope:{ctx:a}}});const m=[Ze,Ye],C=[];function A(l,c){return l[3]?0:1}return i=A(a),I=C[i]=m[i](a),{c(){t=U("input"),n=S(),v(e.$$.fragment),o=S(),r=U("form"),v(s.$$.fragment),$=S(),v(p.$$.fragment),f=S(),_=U("div"),v(O.$$.fragment),b=S(),v(h.$$.fragment),u=S(),I.c(),this.h()},l(l){t=V(l,"INPUT",{class:!0,type:!0}),n=q(l),k(e.$$.fragment,l),o=q(l),r=V(l,"FORM",{method:!0,class:!0});var c=Y(r);k(s.$$.fragment,c),$=q(c),k(p.$$.fragment,c),f=q(c),_=V(c,"DIV",{});var P=Y(_);k(O.$$.fragment,P),b=q(P),k(h.$$.fragment,P),P.forEach(w),u=q(c),I.l(c),c.forEach(w),this.h()},h(){E(t,"class","fixed left-0 top-0 h-0 w-0"),E(t,"type","checkbox"),t.autofocus=!0,E(r,"method","POST"),E(r,"class","space-y-2")},m(l,c){R(l,t,c),R(l,n,c),D(e,l,c),R(l,o,c),R(l,r,c),D(s,r,null),B(r,$),D(p,r,null),B(r,f),B(r,_),D(O,_,null),B(_,b),D(h,_,null),B(r,u),C[i].m(r,null),L=!0,t.focus(),z||(N=ve(a[6].call(null,r)),z=!0)},p(l,c){const P={};c&65536&&(P.$$scope={dirty:c,ctx:l}),e.$set(P);const re={};c&65538&&(re.$$scope={dirty:c,ctx:l}),s.$set(re);const oe={};c&65538&&(oe.$$scope={dirty:c,ctx:l}),p.$set(oe);const ae={};c&65536&&(ae.$$scope={dirty:c,ctx:l}),O.$set(ae);const M={};c&2&&(M.style="background-color:"+l[1].color),c&65538&&(M.$$scope={dirty:c,ctx:l}),h.$set(M);let Q=i;i=A(l),i!==Q&&(Ie(),d(C[Q],1,1,()=>{C[Q]=null}),Re(),I=C[i],I||(I=C[i]=m[i](l),I.c()),g(I,1),I.m(r,null))},i(l){L||(g(e.$$.fragment,l),g(s.$$.fragment,l),g(p.$$.fragment,l),g(O.$$.fragment,l),g(h.$$.fragment,l),g(I),L=!0)},o(l){d(e.$$.fragment,l),d(s.$$.fragment,l),d(p.$$.fragment,l),d(O.$$.fragment,l),d(h.$$.fragment,l),d(I),L=!1},d(l){l&&(w(t),w(n),w(o),w(r)),F(e,l),F(s),F(p),F(O),F(h),C[i].d(),z=!1,N()}}}function tt(a){let t,n;return t=new Ee({props:{class:"sm:max-w-[330px]",$$slots:{default:[et]},$$scope:{ctx:a}}}),{c(){v(t.$$.fragment)},l(e){k(t.$$.fragment,e)},m(e,o){D(t,e,o),n=!0},p(e,o){const r={};o&65546&&(r.$$scope={dirty:o,ctx:e}),t.$set(r)},i(e){n||(g(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){F(t,e)}}}function nt(a){let t,n,e;function o(s){a[12](s)}let r={$$slots:{default:[tt]},$$scope:{ctx:a}};return a[2]!==void 0&&(r.open=a[2]),t=new Se({props:r}),x.push(()=>ne(t,"open",o)),{c(){v(t.$$.fragment)},l(s){k(t.$$.fragment,s)},m(s,$){D(t,s,$),e=!0},p(s,[$]){const p={};$&65546&&(p.$$scope={dirty:$,ctx:s}),!n&&$&4&&(n=!0,p.open=s[2],ee(()=>n=!1)),t.$set(p)},i(s){e||(g(t.$$.fragment,s),e=!0)},o(s){d(t.$$.fragment,s),e=!1},d(s){F(t,s)}}}function rt(a,t,n){let e,o,r,s=te,$=()=>(s(),s=we(h,m=>n(2,r=m)),h),p;G(a,H,m=>n(13,e=m)),G(a,de,m=>n(3,p=m)),a.$$.on_destroy.push(()=>s());const f=qe(Pe(Be(le)),{validators:Le(le),SPA:!0,onUpdate({form:m}){m.valid&&i()},resetForm:!1}),{form:_,enhance:O}=f;G(a,_,m=>n(1,o=m));let{formData:b}=t,{formOpen:h}=t;$();const u=b.id===0;J(_,o=b,o);function i(){const m={name:o.name,color:o.color};u?X.post("tag",m).then(C=>{C.ok&&(J(H,e=[C.data,...e],e),ue())}):X.put(`tag/${b.id}`,m).then(C=>{C.ok&&(n(8,b=o),n(8,b.updated=Date.parse(new Date().toString())/1e3,b),J(H,e[e.findIndex(A=>A.id===b.id)]=b,e),ue())})}function I(m){a.$$.not_equal(o.name,m)&&(o.name=m,_.set(o))}function L(m){a.$$.not_equal(o.color,m)&&(o.color=m,_.set(o))}function z(){o.color=this.value,_.set(o)}function N(m){r=m,h.set(r)}return a.$$set=m=>{"formData"in m&&n(8,b=m.formData),"formOpen"in m&&$(n(0,h=m.formOpen))},[h,o,r,p,f,_,O,u,b,I,L,z,N]}class ot extends Fe{constructor(t){super(),Oe(this,t,rt,nt,he,{formData:8,formOpen:0})}}const H=y([]);function gt(){X.get("tag").then(a=>{a.ok&&H.set(a.data.data)})}function at(){return{id:0,name:"",color:"#000000"}}let W;const Z=y(!1);function dt(a){a||(a=at()),W&&W.$destroy(),W=new ot({target:document.body,props:{formData:a,formOpen:Z}}),Z.set(!0)}function ue(){Z.set(!1)}const bt=y([]);export{gt as i,dt as o,bt as s,H as t};
